import json
import jsonschema
import sys
from jsonschema import Draft4Validator
from jsonschema.exceptions import best_match

def get_json(filename):
    '''
    Returns deserialized JSON if the input file is a valid JSON or False
    otherwise
    '''
    try:
        return json.loads(open(filename).read())
    except ValueError, e:
        print 'Error: Not a valid JSON file:', filename
        print e
        sys.exit(1)

def main():
    vrt_schema = get_json("vrt.schema.json")
    vrt_json = get_json("bugcrowd-vrt.json")

    # Validate valid JSON against the custom schema
    if vrt_schema and vrt_json:
        # Get the most relevant validation error to produce sensical output
        error = best_match(Draft4Validator(vrt_schema).iter_errors(vrt_json))
        if error:
            print(error)
            sys.exit(1)
        else:
            print 'JSON validation success!'

if __name__ == '__main__':
    main()
